--[[
    
   hi dady:
        Window:AddTab(name)
        Tab:AddSection(name, "Left"/"Right")
        Section:AddSubTabs({...}, cb)
        Section:AddToggle(label, default, cb, swatchColor)
        Section:AddSlider(label, min, max, default, cb, suffix)
        Section:AddDropdown(label, {opts}, default, cb)
        Section:AddMultibox(label, {opts}, {defaults}, cb)
        Section:AddKeybind(label, default, cb)
        Section:AddColorPicker(label, Color3, cb)
        Section:AddButton(label, cb, danger)
        Section:AddLabel(text)
        Section:AddSeparator()
        Section:AddProfileList({names}, cb)
        Window:Dialog(msg, cb)
        
    Notify):
        Notify(text, position, duration)
        position: "Top" | "Bottom" | "Left" | "Right"
]]

local TS  = game:GetService("TweenService")
local UIS = game:GetService("UserInputService")
local HS  = game:GetService("HttpService")
local CG  = game:GetService("CoreGui")

local FONT
do
    local ok = pcall(function()
        local aid  = "SmallestPixel.ttf"
        local fname = "PixelDC"
        if not isfile(aid) then
            writefile(aid, game:HttpGet(
                "https://raw.githubusercontent.com/onlymolyigoontofemboys/BETA/main/smallest_pixel-7.ttf"
            ))
        end
        writefile(fname..".font", HS:JSONEncode({
            name  = fname,
            faces = {{ name="Regular", weight=400, style="normal", assetId=getcustomasset(aid) }},
        }))
        FONT = Font.new(getcustomasset(fname..".font"))
    end)
    if not ok then FONT = Font.new("rbxasset://fonts/families/RobotoMono.json") end
end

local BG       = Color3.fromRGB(26,  26,  28)
local BG_H     = Color3.fromRGB(20,  20,  22)
local BG_ITEM  = Color3.fromRGB(32,  32,  34)
local BG_IN    = Color3.fromRGB(18,  18,  20)
local ACC      = Color3.fromRGB(204, 51,  51)
local ACC_LT   = Color3.fromRGB(224, 85,  85)
local BOR      = Color3.fromRGB(50,  50,  52)
local TXT      = Color3.fromRGB(200, 200, 204)
local TXT_D    = Color3.fromRGB(95,  95,  99)
local TXT_H    = Color3.fromRGB(232, 232, 234)
local WHITE    = Color3.fromRGB(255, 255, 255)
local ACC_DARK = Color3.fromRGB(45,  14,  14)

local FAST = TweenInfo.new(0.15, Enum.EasingStyle.Quart, Enum.EasingDirection.Out)
local MED  = TweenInfo.new(0.25, Enum.EasingStyle.Quart, Enum.EasingDirection.Out)

local function tw(o, p, ti)   TweenService and nil ; TS:Create(o, ti or FAST, p):Play() end
local function new(cl, p, pa)
    local o = Instance.new(cl)
    for k,v in pairs(p) do o[k]=v end
    if pa then o.Parent=pa end
    return o
end
local function corner(p,r)  local c=Instance.new("UICorner"); c.CornerRadius=UDim.new(0,r or 2); c.Parent=p end
local function stroke(p,c,t)
    local s=Instance.new("UIStroke"); s.Color=c or BOR; s.Thickness=t or 1
    s.ApplyStrokeMode=Enum.ApplyStrokeMode.Border; s.Parent=p; return s
end
local function pad(p,t,b,l,r)
    local u=Instance.new("UIPadding")
    u.PaddingTop=UDim.new(0,t or 0); u.PaddingBottom=UDim.new(0,b or 0)
    u.PaddingLeft=UDim.new(0,l or 0); u.PaddingRight=UDim.new(0,r or 0); u.Parent=p
end
local function vlist(p,gap)
    local l=Instance.new("UIListLayout"); l.FillDirection=Enum.FillDirection.Vertical
    l.SortOrder=Enum.SortOrder.LayoutOrder; l.Padding=UDim.new(0,gap or 0); l.Parent=p; return l
end
local function hlist(p,gap)
    local l=Instance.new("UIListLayout"); l.FillDirection=Enum.FillDirection.Horizontal
    l.SortOrder=Enum.SortOrder.LayoutOrder; l.Padding=UDim.new(0,gap or 0); l.Parent=p; return l
end

local function makeSlider(track, fill, valLbl, minV, maxV, defV, suffix, cb)
    suffix = suffix or ""
    local val = math.clamp(defV or minV, minV, maxV)

    local function setVal(v)
        val = math.clamp(math.round(v * 10) / 10, minV, maxV)
        local t = (val - minV) / (maxV - minV)
        fill.Size   = UDim2.new(t, 0, 1, 0)
        valLbl.Text = tostring(val) .. suffix
        if cb then cb(val) end
    end

    local initT = (val - minV) / (maxV - minV)
    fill.Size   = UDim2.new(initT, 0, 1, 0)
    valLbl.Text = tostring(val) .. suffix

    local dragging   = false
    local captureFrame = nil

    local function calcVal(x)
        local ax = track.AbsolutePosition.X
        local aw = track.AbsoluteSize.X
        if aw == 0 then return val end
        local t = math.clamp((x - ax) / aw, 0, 1)
        return minV + t * (maxV - minV)
    end

    track.InputBegan:Connect(function(i)
        if i.UserInputType ~= Enum.UserInputType.MouseButton1 then return end
        dragging = true
        setVal(calcVal(i.Position.X))

        if captureFrame then captureFrame:Destroy() end
        local sg = CG:FindFirstChild("DeadcellUI")
        if sg then
            captureFrame = new("Frame", {
                Size                   = UDim2.new(1,0,1,0),
                BackgroundTransparency = 1,
                ZIndex                 = 9999,
            }, sg)

            captureFrame.InputChanged:Connect(function(mi)
                if dragging and mi.UserInputType == Enum.UserInputType.MouseMovement then
                    setVal(calcVal(mi.Position.X))
                end
            end)
            captureFrame.InputEnded:Connect(function(mi)
                if mi.UserInputType == Enum.UserInputType.MouseButton1 then
                    dragging = false
                    captureFrame:Destroy()
                    captureFrame = nil
                end
            end)
        end
    end)

    local S = {}
    function S:Set(v) setVal(v) end
    function S:Get() return val end
    return S
end

local NotifySG
local ActiveNotifs = {}

local function ensureNotifySG()
    if NotifySG and NotifySG.Parent then return end
    NotifySG = new("ScreenGui", {
        Name         = "DeadcellNotify",
        ResetOnSpawn = false,
        ZIndexBehavior = Enum.ZIndexBehavior.Sibling,
        DisplayOrder = 999,
    }, CG)
end

local function reflow(position)
    local offset = 0
    local isVert = position == "Top" or position == "Bottom"
    for i = #ActiveNotifs, 1, -1 do
        local f = ActiveNotifs[i]
        local fw = f.Size.X.Offset
        local fh = f.Size.Y.Offset
        local target
        if position == "Top" then
            target = UDim2.new(0.5, -fw/2, 0, 14 + offset)
        elseif position == "Bottom" then
            target = UDim2.new(0.5, -fw/2, 1, -14 - fh - offset)
        elseif position == "Left" then
            target = UDim2.new(0, 14, 0.5, -fh/2 - offset)
        else
            target = UDim2.new(1, -fw - 14, 0.5, -fh/2 - offset)
        end
        tw(f, { Position = target }, TweenInfo.new(0.25, Enum.EasingStyle.Quart, Enum.EasingDirection.Out))
        if isVert then
            offset = offset + fh + 6
        else
            offset = offset + fh + 6
        end
    end
end

local DeadcellUI = {}

function DeadcellUI.Notify(text, position, duration)
    position = position or "Right"
    duration = duration or 3.5
    ensureNotifySG()

    local upper = text:upper()

    -- medir texto
    local dummyLbl = new("TextLabel", {
        Size       = UDim2.new(0,500,0,20),
        Text       = upper,
        FontFace   = FONT,
        TextSize   = 13,
        Visible    = false,
    }, NotifySG)
    local tw_ = dummyLbl.TextBounds.X
    dummyLbl:Destroy()
    local fw = math.max(60, tw_ + 30)
    local fh = 30

    -- posição inicial (fora da tela)
    local startPos
    if position == "Top" then
        startPos = UDim2.new(0.5, -fw/2, 0, -fh - 10)
    elseif position == "Bottom" then
        startPos = UDim2.new(0.5, -fw/2, 1, fh + 10)
    elseif position == "Left" then
        startPos = UDim2.new(0, -fw - 10, 0.5, -fh/2)
    else
        startPos = UDim2.new(1, fw + 10, 0.5, -fh/2)
    end

    local frame = new("Frame", {
        Size             = UDim2.new(0, fw, 0, fh),
        Position         = startPos,
        BackgroundColor3 = BG,
        BackgroundTransparency = 0.1,
        BorderSizePixel  = 0,
        ClipsDescendants = true,
        ZIndex           = 100,
    }, NotifySG)
    corner(frame, 2)
    stroke(frame, BOR, 1)

    -- barra accent esquerda
    new("Frame", {
        Size             = UDim2.new(0, 2, 1, 0),
        BackgroundColor3 = ACC,
        BorderSizePixel  = 0,
        ZIndex           = 101,
    }, frame)

    local lbl = new("TextLabel", {
        Size                   = UDim2.new(1, -14, 1, 0),
        Position               = UDim2.new(0, 10, 0, 0),
        BackgroundTransparency = 1,
        Text                   = "",
        TextColor3             = TXT_H,
        FontFace               = FONT,
        TextSize               = 13,
        TextXAlignment         = Enum.TextXAlignment.Left,
        ZIndex                 = 101,
    }, frame)

    table.insert(ActiveNotifs, frame)
    reflow(position)

    -- typewriter
    task.spawn(function()
        for i = 1, #upper do
            lbl.Text = string.sub(upper, 1, i)
            task.wait(0.025)
        end
    end)

    -- barra de progresso
    local bar = new("Frame", {
        Size             = UDim2.new(1, 0, 0, 1),
        Position         = UDim2.new(0, 0, 1, -1),
        BackgroundColor3 = ACC,
        BorderSizePixel  = 0,
        ZIndex           = 102,
    }, frame)
    TS:Create(bar, TweenInfo.new(duration, Enum.EasingStyle.Linear), { Size = UDim2.new(0, 0, 0, 1) }):Play()

    -- remover
    task.delay(duration, function()
        for i, v in ipairs(ActiveNotifs) do
            if v == frame then table.remove(ActiveNotifs, i); break end
        end
        reflow(position)

        local exitPos
        if position == "Top" then
            exitPos = UDim2.new(frame.Position.X.Scale, frame.Position.X.Offset, 0, -fh - 10)
        elseif position == "Bottom" then
            exitPos = UDim2.new(frame.Position.X.Scale, frame.Position.X.Offset, 1, fh + 10)
        elseif position == "Left" then
            exitPos = UDim2.new(0, -fw - 10, frame.Position.Y.Scale, frame.Position.Y.Offset)
        else
            exitPos = UDim2.new(1, fw + 10, frame.Position.Y.Scale, frame.Position.Y.Offset)
        end

        local t = TS:Create(frame, TweenInfo.new(0.35, Enum.EasingStyle.Quart, Enum.EasingDirection.In), {
            Position = exitPos,
            BackgroundTransparency = 1,
        })
        t:Play()
        t.Completed:Connect(function() frame:Destroy() end)
    end)
end

-- ─── CreateWindow ─────────────────────────────────────────────────────────────
function DeadcellUI.CreateWindow()
    local old = CG:FindFirstChild("DeadcellUI")
    if old then old:Destroy() end

    local sg = new("ScreenGui", {
        Name           = "DeadcellUI",
        ResetOnSpawn   = false,
        ZIndexBehavior = Enum.ZIndexBehavior.Sibling,
    }, CG)

    local win = new("Frame", {
        Name             = "Win",
        Size             = UDim2.new(0, 640, 0, 410),
        Position         = UDim2.new(0.5, -320, 0.5, -205),
        BackgroundColor3 = BG,
        BorderSizePixel  = 0,
        ClipsDescendants = true,
        BackgroundTransparency = 0,
    }, sg)
    corner(win, 2)
    stroke(win, BOR, 1)

    -- ── Drag (só pelo header) ─────────────────────────────────────────────────
    local header = new("Frame", {
        Size             = UDim2.new(1, 0, 0, 32),
        BackgroundColor3 = BG_H,
        BorderSizePixel  = 0,
        ZIndex           = 5,
    }, win)
    new("Frame", {
        Size             = UDim2.new(1, 0, 0, 1),
        Position         = UDim2.new(0, 0, 1, -1),
        BackgroundColor3 = BOR,
        BorderSizePixel  = 0,
        ZIndex           = 5,
    }, header)

    do
        local drag = false
        local ds, sp = nil, nil
        header.InputBegan:Connect(function(i)
            if i.UserInputType == Enum.UserInputType.MouseButton1 then
                drag = true; ds = i.Position; sp = win.Position
            end
        end)
        UIS.InputChanged:Connect(function(i)
            if drag and i.UserInputType == Enum.UserInputType.MouseMovement then
                local d = i.Position - ds
                win.Position = UDim2.new(sp.X.Scale, sp.X.Offset+d.X, sp.Y.Scale, sp.Y.Offset+d.Y)
            end
        end)
        UIS.InputEnded:Connect(function(i)
            if i.UserInputType == Enum.UserInputType.MouseButton1 then drag = false end
        end)
    end

    local tabRow = new("Frame", {
        Size                   = UDim2.new(1, 0, 1, 0),
        BackgroundTransparency = 1,
        ZIndex                 = 6,
    }, header)
    hlist(tabRow, 0)

    local content = new("Frame", {
        Size                   = UDim2.new(1, 0, 1, -32),
        Position               = UDim2.new(0, 0, 0, 32),
        BackgroundTransparency = 1,
        ClipsDescendants       = true,
    }, win)

    -- ── Toggle visibilidade com fade ──────────────────────────────────────────
    local visible = true
    UIS.InputBegan:Connect(function(i, gpe)
        if gpe then return end
        if i.KeyCode == Enum.KeyCode.Insert then
            if visible then
                visible = false
                TS:Create(win, MED, { BackgroundTransparency = 1 }):Play()
                task.delay(0.25, function() win.Visible = false end)
            else
                visible = true
                win.Visible = true
                win.BackgroundTransparency = 1
                TS:Create(win, MED, { BackgroundTransparency = 0 }):Play()
            end
        end
    end)

    local Window    = {}
    local activeTab = nil
    local tabCount  = 0

    local function activateTab(tab)
        if activeTab == tab then return end
        if activeTab then
            activeTab.frame.Visible = false
            tw(activeTab.btn, { TextColor3 = TXT_D })
            activeTab.line.BackgroundTransparency = 1
        end
        activeTab = tab
        tab.frame.Visible = true
        tw(tab.btn, { TextColor3 = TXT_H })
        tab.line.BackgroundTransparency = 0
    end

    -- ── Dialog ────────────────────────────────────────────────────────────────
    local dlgOverlay = new("Frame", {
        Size                   = UDim2.new(1, 0, 1, 0),
        BackgroundColor3       = Color3.fromRGB(0,0,0),
        BackgroundTransparency = 1,
        BorderSizePixel        = 0,
        Visible                = false,
        ZIndex                 = 50,
    }, win)
    local dlgBox = new("Frame", {
        Size             = UDim2.new(0, 310, 0, 88),
        Position         = UDim2.new(0.5, -155, 0.5, -44),
        BackgroundColor3 = BG,
        BorderSizePixel  = 0,
        ZIndex           = 51,
    }, dlgOverlay)
    corner(dlgBox, 2)
    stroke(dlgBox, Color3.fromRGB(75,75,78), 1)
    local dlgText = new("TextLabel", {
        Size=UDim2.new(1,-20,0,38), Position=UDim2.new(0,10,0,10),
        BackgroundTransparency=1, Text="", TextColor3=TXT,
        FontFace=FONT, TextSize=12, TextWrapped=true, ZIndex=52,
    }, dlgBox)
    local dlgYes = new("TextButton", {
        Size=UDim2.new(0,80,0,22), Position=UDim2.new(0.5,-86,1,-30),
        BackgroundColor3=Color3.fromRGB(48,12,12), BorderSizePixel=0,
        Text="Yes", TextColor3=ACC_LT, FontFace=FONT, TextSize=11, AutoButtonColor=false, ZIndex=52,
    }, dlgBox)
    corner(dlgYes,1); stroke(dlgYes,ACC,1)
    local dlgNo = new("TextButton", {
        Size=UDim2.new(0,80,0,22), Position=UDim2.new(0.5,6,1,-30),
        BackgroundColor3=BG_ITEM, BorderSizePixel=0,
        Text="No", TextColor3=TXT, FontFace=FONT, TextSize=11, AutoButtonColor=false, ZIndex=52,
    }, dlgBox)
    corner(dlgNo,1); stroke(dlgNo,BOR,1)
    local dlgCb = nil
    local function closeDlg(r)
        tw(dlgOverlay, { BackgroundTransparency=1 })
        task.delay(0.16, function() dlgOverlay.Visible=false end)
        if dlgCb then dlgCb(r); dlgCb=nil end
    end
    dlgYes.MouseButton1Click:Connect(function() closeDlg(true) end)
    dlgNo.MouseButton1Click:Connect(function() closeDlg(false) end)
    function Window:Dialog(msg, cb)
        dlgText.Text=msg; dlgCb=cb
        dlgOverlay.Visible=true
        tw(dlgOverlay, { BackgroundTransparency=0.55 })
    end

    -- ══════════════════════════════════════════════
    -- AddTab
    -- ══════════════════════════════════════════════
    function Window:AddTab(name)
        tabCount = tabCount + 1
        local tab = {}

        local btn = new("TextButton", {
            Size=UDim2.new(0,128,1,0), BackgroundTransparency=1,
            Text=name, TextColor3=TXT_D, FontFace=FONT, TextSize=12,
            AutoButtonColor=false, BorderSizePixel=0, ZIndex=6,
        }, tabRow)
        local line = new("Frame", {
            Size=UDim2.new(1,0,0,1), Position=UDim2.new(0,0,1,-1),
            BackgroundColor3=ACC, BackgroundTransparency=1, BorderSizePixel=0, ZIndex=7,
        }, btn)
        new("Frame", {
            Size=UDim2.new(0,1,1,0), Position=UDim2.new(1,-1,0,0),
            BackgroundColor3=BOR, BorderSizePixel=0, ZIndex=6,
        }, btn)

        local frame = new("Frame", {
            Size=UDim2.new(1,0,1,0), BackgroundTransparency=1, Visible=false,
        }, content)

        local lScroll = new("ScrollingFrame", {
            Size=UDim2.new(0.5,-1,1,0), BackgroundTransparency=1, BorderSizePixel=0,
            ScrollBarThickness=2, ScrollBarImageColor3=BOR,
            CanvasSize=UDim2.new(0,0,0,0), AutomaticCanvasSize=Enum.AutomaticSize.Y,
        }, frame)
        pad(lScroll, 12,12,14,14); vlist(lScroll, 6)

        new("Frame", {
            Size=UDim2.new(0,1,1,0), Position=UDim2.new(0.5,0,0,0),
            BackgroundColor3=BOR, BorderSizePixel=0,
        }, frame)

        local rScroll = new("ScrollingFrame", {
            Size=UDim2.new(0.5,-1,1,0), Position=UDim2.new(0.5,1,0,0),
            BackgroundTransparency=1, BorderSizePixel=0,
            ScrollBarThickness=2, ScrollBarImageColor3=BOR,
            CanvasSize=UDim2.new(0,0,0,0), AutomaticCanvasSize=Enum.AutomaticSize.Y,
        }, frame)
        pad(rScroll, 12,12,14,14); vlist(rScroll, 6)

        tab.btn=btn; tab.line=line; tab.frame=frame; tab.left=lScroll; tab.right=rScroll

        btn.MouseButton1Click:Connect(function() activateTab(tab) end)
        btn.MouseEnter:Connect(function()
            if activeTab~=tab then tw(btn,{TextColor3=TXT}) end
        end)
        btn.MouseLeave:Connect(function()
            if activeTab~=tab then tw(btn,{TextColor3=TXT_D}) end
        end)

        if tabCount == 1 then activateTab(tab) end

        local Tab = {}

        -- ════════════════════════════════════════
        -- AddSection
        -- ════════════════════════════════════════
        function Tab:AddSection(sName, side)
            local panel = (side=="Right") and rScroll or lScroll

            local tf = new("Frame", {
                Size=UDim2.new(1,0,0,20), BackgroundTransparency=1,
            }, panel)
            new("TextLabel", {
                Size=UDim2.new(1,0,0,14), BackgroundTransparency=1,
                Text=sName:upper(), TextColor3=TXT_D, FontFace=FONT, TextSize=10,
                TextXAlignment=Enum.TextXAlignment.Left,
            }, tf)
            new("Frame", {
                Size=UDim2.new(1,0,0,1), Position=UDim2.new(0,0,1,-1),
                BackgroundColor3=BOR, BorderSizePixel=0,
            }, tf)

            local items = new("Frame", {
                Size=UDim2.new(1,0,0,0), BackgroundTransparency=1,
                AutomaticSize=Enum.AutomaticSize.Y,
            }, panel)
            vlist(items, 3)

            local Section = {}

            -- ── SubTabs ──────────────────────────────
            function Section:AddSubTabs(tabList, cb)
                local row = new("Frame", {
                    Size=UDim2.new(1,0,0,22), BackgroundTransparency=1,
                }, items)
                hlist(row, 3)

                local activeSub    = nil
                local activeStr    = nil

                for _, tName in ipairs(tabList) do
                    local sb = new("TextButton", {
                        Size=UDim2.new(0,0,1,0), AutomaticSize=Enum.AutomaticSize.X,
                        BackgroundColor3=BG_ITEM, BorderSizePixel=0,
                        Text=tName, TextColor3=TXT_D, FontFace=FONT, TextSize=11,
                        AutoButtonColor=false,
                    }, row)
                    corner(sb,1); pad(sb,3,3,10,10)
                    local ss = stroke(sb, BOR, 1)

                    local isFirst = (activeSub == nil)
                    if isFirst then
                        activeSub = sb; activeStr = ss
                        sb.TextColor3=TXT_H; sb.BackgroundColor3=ACC_DARK; ss.Color=ACC
                    end

                    sb.MouseButton1Click:Connect(function()
                        if activeSub then
                            local prev = activeSub; local pstr = activeStr
                            tw(prev, {TextColor3=TXT_D, BackgroundColor3=BG_ITEM})
                            pstr.Color = BOR
                        end
                        activeSub=sb; activeStr=ss
                        tw(sb, {TextColor3=TXT_H, BackgroundColor3=ACC_DARK})
                        ss.Color=ACC
                        if cb then cb(tName) end
                    end)
                end
            end

            -- ── Toggle ───────────────────────────────
            function Section:AddToggle(labelText, default, cb, swatchColor)
                local state = default == true
                local row = new("Frame", {
                    Size=UDim2.new(1,0,0,20), BackgroundTransparency=1,
                }, items)

                local box = new("Frame", {
                    Size=UDim2.new(0,10,0,10), Position=UDim2.new(0,0,0.5,-5),
                    BackgroundColor3=state and ACC or BG_IN, BorderSizePixel=0,
                }, row)
                local bs = stroke(box, state and ACC or Color3.fromRGB(75,75,78), 1)
                local tick = new("TextLabel", {
                    Size=UDim2.new(1,0,1,0), BackgroundTransparency=1,
                    Text="v", TextColor3=WHITE, FontFace=FONT, TextSize=9,
                    TextTransparency=state and 0 or 1,
                }, box)

                new("TextLabel", {
                    Size=UDim2.new(1,-20,1,0), Position=UDim2.new(0,18,0,0),
                    BackgroundTransparency=1, Text=labelText, TextColor3=TXT,
                    FontFace=FONT, TextSize=13, TextXAlignment=Enum.TextXAlignment.Left,
                }, row)

                if swatchColor then
                    local sw = new("Frame", {
                        Size=UDim2.new(0,22,0,10), Position=UDim2.new(1,-22,0.5,-5),
                        BackgroundColor3=swatchColor, BorderSizePixel=0,
                    }, row)
                    corner(sw,1); stroke(sw,Color3.fromRGB(55,55,57),1)
                end

                local btn = new("TextButton", {
                    Size=UDim2.new(1,0,1,0), BackgroundTransparency=1, Text="", ZIndex=5,
                }, row)
                btn.MouseButton1Click:Connect(function()
                    state = not state
                    tw(box, {BackgroundColor3=state and ACC or BG_IN})
                    bs.Color = state and ACC or Color3.fromRGB(75,75,78)
                    tick.TextTransparency = state and 0 or 1
                    if cb then cb(state) end
                end)

                local T={}
                function T:Set(v)
                    state=v; box.BackgroundColor3=state and ACC or BG_IN
                    bs.Color=state and ACC or Color3.fromRGB(75,75,78)
                    tick.TextTransparency=state and 0 or 1
                end
                function T:Get() return state end
                return T
            end

            -- ── Slider (fix: captura numa camada própria) ─
            function Section:AddSlider(labelText, minV, maxV, defV, cb, suffix)
                local wrap = new("Frame", {
                    Size=UDim2.new(1,0,0,32), BackgroundTransparency=1,
                }, items)
                new("TextLabel", {
                    Size=UDim2.new(1,0,0,13), BackgroundTransparency=1,
                    Text=labelText, TextColor3=TXT_D, FontFace=FONT, TextSize=10,
                    TextXAlignment=Enum.TextXAlignment.Left,
                }, wrap)
                local track = new("Frame", {
                    Size=UDim2.new(1,0,0,3), Position=UDim2.new(0,0,0,20),
                    BackgroundColor3=Color3.fromRGB(42,42,44), BorderSizePixel=0,
                }, wrap)
                local fill = new("Frame", {
                    Size=UDim2.new(0,0,1,0), BackgroundColor3=ACC, BorderSizePixel=0,
                }, track)
                local valLbl = new("TextLabel", {
                    Size=UDim2.new(0,40,0,12), Position=UDim2.new(1,-40,0,18),
                    BackgroundTransparency=1, Text="", TextColor3=TXT_D,
                    FontFace=FONT, TextSize=10, TextXAlignment=Enum.TextXAlignment.Right,
                }, wrap)
                return makeSlider(track, fill, valLbl, minV, maxV, defV, suffix, cb)
            end

            -- ── Dropdown ─────────────────────────────────
            function Section:AddDropdown(labelText, options, default, cb)
                local selected = default or options[1]
                local isOpen   = false

                local wrap = new("Frame", {
                    Size=UDim2.new(1,0,0,42), BackgroundTransparency=1,
                    ClipsDescendants=false, ZIndex=3,
                }, items)
                new("TextLabel", {
                    Size=UDim2.new(1,0,0,13), BackgroundTransparency=1,
                    Text=labelText, TextColor3=TXT_D, FontFace=FONT, TextSize=10,
                    TextXAlignment=Enum.TextXAlignment.Left, ZIndex=3,
                }, wrap)

                local selBtn = new("TextButton", {
                    Size=UDim2.new(1,0,0,22), Position=UDim2.new(0,0,0,15),
                    BackgroundColor3=BG_IN, BorderSizePixel=0,
                    Text=selected.."  v", TextColor3=TXT, FontFace=FONT, TextSize=11,
                    TextXAlignment=Enum.TextXAlignment.Left, AutoButtonColor=false, ZIndex=4,
                }, wrap)
                pad(selBtn,0,0,7,0); stroke(selBtn,BOR,1)

                local listF = new("Frame", {
                    Size=UDim2.new(1,0,0,0), Position=UDim2.new(0,0,0,38),
                    BackgroundColor3=BG_IN, BorderSizePixel=0,
                    ClipsDescendants=true, ZIndex=20, Visible=false,
                }, wrap)
                stroke(listF,BOR,1); vlist(listF, 0)

                local function closeDD()
                    isOpen=false
                    tw(listF, {Size=UDim2.new(1,0,0,0)})
                    task.delay(0.16, function()
                        if not isOpen then listF.Visible=false end
                    end)
                    wrap.Size=UDim2.new(1,0,0,42)
                end

                for _, opt in ipairs(options) do
                    local ob = new("TextButton", {
                        Size=UDim2.new(1,0,0,20), BackgroundTransparency=1,
                        Text=opt, TextColor3=opt==selected and ACC_LT or TXT,
                        FontFace=FONT, TextSize=11, TextXAlignment=Enum.TextXAlignment.Left,
                        AutoButtonColor=false, ZIndex=21,
                    }, listF)
                    pad(ob,0,0,8,0)
                    ob.MouseEnter:Connect(function()
                        ob.BackgroundTransparency=0; ob.BackgroundColor3=Color3.fromRGB(38,12,12)
                    end)
                    ob.MouseLeave:Connect(function() ob.BackgroundTransparency=1 end)
                    ob.MouseButton1Click:Connect(function()
                        selected=opt; selBtn.Text=opt.."  v"
                        for _, c in ipairs(listF:GetChildren()) do
                            if c:IsA("TextButton") then
                                c.TextColor3 = c.Text==opt and ACC_LT or TXT
                            end
                        end
                        if cb then cb(opt) end
                        closeDD()
                    end)
                end

                selBtn.MouseButton1Click:Connect(function()
                    isOpen=not isOpen
                    if isOpen then
                        listF.Visible=true
                        local h=#options*20
                        tw(listF, {Size=UDim2.new(1,0,0,h)})
                        wrap.Size=UDim2.new(1,0,0,42+h)
                    else closeDD() end
                end)

                local D={}
                function D:Set(v) selected=v; selBtn.Text=v.."  v" end
                function D:Get() return selected end
                return D
            end

            -- ── Multibox ─────────────────────────────────
            function Section:AddMultibox(labelText, options, defaults, cb)
                local checked = {}
                for _, opt in ipairs(options) do
                    checked[opt] = defaults and (table.find(defaults, opt) ~= nil) or false
                end

                local isOpen = false
                local function getLabel()
                    local sel = {}
                    for _, opt in ipairs(options) do
                        if checked[opt] then table.insert(sel, opt) end
                    end
                    return #sel==0 and "None" or table.concat(sel, ", ")
                end

                local wrap = new("Frame", {
                    Size=UDim2.new(1,0,0,42), BackgroundTransparency=1,
                    ClipsDescendants=false, ZIndex=3,
                }, items)
                new("TextLabel", {
                    Size=UDim2.new(1,0,0,13), BackgroundTransparency=1,
                    Text=labelText, TextColor3=TXT_D, FontFace=FONT, TextSize=10,
                    TextXAlignment=Enum.TextXAlignment.Left, ZIndex=3,
                }, wrap)

                local selBtn = new("TextButton", {
                    Size=UDim2.new(1,0,0,22), Position=UDim2.new(0,0,0,15),
                    BackgroundColor3=BG_IN, BorderSizePixel=0,
                    Text=getLabel().."  v", TextColor3=TXT, FontFace=FONT, TextSize=11,
                    TextXAlignment=Enum.TextXAlignment.Left, AutoButtonColor=false, ZIndex=4,
                }, wrap)
                pad(selBtn,0,0,7,0); stroke(selBtn,BOR,1)

                local listF = new("Frame", {
                    Size=UDim2.new(1,0,0,0), Position=UDim2.new(0,0,0,38),
                    BackgroundColor3=BG_IN, BorderSizePixel=0,
                    ClipsDescendants=true, ZIndex=20, Visible=false,
                }, wrap)
                stroke(listF,BOR,1); vlist(listF, 0)

                local function closeMB()
                    isOpen=false
                    tw(listF, {Size=UDim2.new(1,0,0,0)})
                    task.delay(0.16, function()
                        if not isOpen then listF.Visible=false end
                    end)
                    wrap.Size=UDim2.new(1,0,0,42)
                end

                for _, opt in ipairs(options) do
                    local row2 = new("Frame", {
                        Size=UDim2.new(1,0,0,22), BackgroundTransparency=1, ZIndex=21,
                    }, listF)

                    local box2 = new("Frame", {
                        Size=UDim2.new(0,9,0,9), Position=UDim2.new(0,8,0.5,-4),
                        BackgroundColor3=checked[opt] and ACC or BG_IN, BorderSizePixel=0, ZIndex=22,
                    }, row2)
                    local bs2 = stroke(box2, checked[opt] and ACC or Color3.fromRGB(75,75,78), 1)
                    local tick2 = new("TextLabel", {
                        Size=UDim2.new(1,0,1,0), BackgroundTransparency=1,
                        Text="v", TextColor3=WHITE, FontFace=FONT, TextSize=8,
                        TextTransparency=checked[opt] and 0 or 1, ZIndex=23,
                    }, box2)

                    new("TextLabel", {
                        Size=UDim2.new(1,-26,1,0), Position=UDim2.new(0,24,0,0),
                        BackgroundTransparency=1, Text=opt, TextColor3=TXT,
                        FontFace=FONT, TextSize=11, TextXAlignment=Enum.TextXAlignment.Left, ZIndex=22,
                    }, row2)

                    local rowBtn = new("TextButton", {
                        Size=UDim2.new(1,0,1,0), BackgroundTransparency=1, Text="", ZIndex=24,
                    }, row2)
                    rowBtn.MouseEnter:Connect(function()
                        row2.BackgroundTransparency=0; row2.BackgroundColor3=Color3.fromRGB(36,12,12)
                    end)
                    rowBtn.MouseLeave:Connect(function() row2.BackgroundTransparency=1 end)

                    rowBtn.MouseButton1Click:Connect(function()
                        checked[opt] = not checked[opt]
                        box2.BackgroundColor3 = checked[opt] and ACC or BG_IN
                        bs2.Color = checked[opt] and ACC or Color3.fromRGB(75,75,78)
                        tick2.TextTransparency = checked[opt] and 0 or 1
                        selBtn.Text = getLabel().."  v"
                        if cb then cb(checked) end
                    end)
                end

                selBtn.MouseButton1Click:Connect(function()
                    isOpen=not isOpen
                    if isOpen then
                        listF.Visible=true
                        local h=#options*22
                        tw(listF, {Size=UDim2.new(1,0,0,h)})
                        wrap.Size=UDim2.new(1,0,0,42+h)
                    else closeMB() end
                end)

                local M={}
                function M:Get() return checked end
                function M:SetOption(opt, v)
                    checked[opt]=v
                    selBtn.Text=getLabel().."  v"
                end
                return M
            end

            -- ── Keybind ──────────────────────────────────
            function Section:AddKeybind(labelText, default, cb)
                local key     = default or ""
                local waiting = false
                local listenC = nil

                local wrap = new("Frame", {
                    Size=UDim2.new(1,0,0,42), BackgroundTransparency=1,
                }, items)
                new("TextLabel", {
                    Size=UDim2.new(1,0,0,13), BackgroundTransparency=1,
                    Text=labelText, TextColor3=TXT_D, FontFace=FONT, TextSize=10,
                    TextXAlignment=Enum.TextXAlignment.Left,
                }, wrap)
                local bb = new("TextButton", {
                    Size=UDim2.new(0.6,0,0,22), Position=UDim2.new(0,0,0,15),
                    BackgroundColor3=BG_IN, BorderSizePixel=0,
                    Text=key=="" and "[ ... ]" or "[ "..key.." ]",
                    TextColor3=TXT, FontFace=FONT, TextSize=11, AutoButtonColor=false,
                }, wrap)
                stroke(bb,BOR,1)
                local cb2 = new("TextButton", {
                    Size=UDim2.new(0,18,0,18), Position=UDim2.new(0.6,4,0,17),
                    BackgroundColor3=BG_ITEM, BorderSizePixel=0,
                    Text="x", TextColor3=TXT_D, FontFace=FONT, TextSize=10,
                    AutoButtonColor=false, Visible=key~="",
                }, wrap)
                corner(cb2,1)

                bb.MouseButton1Click:Connect(function()
                    if waiting then return end
                    waiting=true; bb.Text="[ ... ]"; bb.TextColor3=ACC_LT
                    if listenC then listenC:Disconnect() end
                    listenC = UIS.InputBegan:Connect(function(i, gpe)
                        if gpe then return end
                        if i.UserInputType==Enum.UserInputType.Keyboard then
                            key=i.KeyCode.Name; bb.Text="[ "..key.." ]"
                            bb.TextColor3=TXT; cb2.Visible=true; waiting=false
                            listenC:Disconnect()
                            if cb then cb(key) end
                        end
                    end)
                end)
                cb2.MouseButton1Click:Connect(function()
                    key=""; bb.Text="[ ... ]"; cb2.Visible=false
                    if cb then cb(key) end
                end)

                local K={}
                function K:Get() return key end
                return K
            end

            -- ── ColorPicker ──────────────────────────────
            function Section:AddColorPicker(labelText, defaultColor, cb)
                local color = defaultColor or Color3.fromRGB(255,255,255)
                local r,g,b = color.R, color.G, color.B
                local pickerOpen = false
                local pickerFrame = nil

                local row = new("Frame", {
                    Size=UDim2.new(1,0,0,20), BackgroundTransparency=1,
                }, items)
                new("TextLabel", {
                    Size=UDim2.new(1,-30,1,0), Position=UDim2.new(0,0,0,0),
                    BackgroundTransparency=1, Text=labelText, TextColor3=TXT,
                    FontFace=FONT, TextSize=13, TextXAlignment=Enum.TextXAlignment.Left,
                }, row)
                local swatch = new("TextButton", {
                    Size=UDim2.new(0,22,0,12), Position=UDim2.new(1,-22,0.5,-6),
                    BackgroundColor3=color, BorderSizePixel=0,
                    Text="", AutoButtonColor=false, ZIndex=5,
                }, row)
                corner(swatch,1); stroke(swatch,Color3.fromRGB(60,60,62),1)

                local function updateColor()
                    color = Color3.new(r,g,b)
                    swatch.BackgroundColor3 = color
                    if cb then cb(color) end
                end

                local function buildPicker()
                    pickerFrame = new("Frame", {
                        Size=UDim2.new(0,180,0,0), Position=UDim2.new(0,-90,1,6),
                        BackgroundColor3=BG_ITEM, BorderSizePixel=0,
                        AutomaticSize=Enum.AutomaticSize.Y,
                        ZIndex=30, ClipsDescendants=false,
                    }, row)
                    corner(pickerFrame,3); stroke(pickerFrame,BOR,1)
                    pad(pickerFrame,8,8,10,10)
                    vlist(pickerFrame,6)

                    local channels = {
                        { label="R", getter=function() return r end, setter=function(v) r=v end, col=Color3.fromRGB(200,50,50) },
                        { label="G", getter=function() return g end, setter=function(v) g=v end, col=Color3.fromRGB(50,180,50) },
                        { label="B", getter=function() return b end, setter=function(v) b=v end, col=Color3.fromRGB(60,100,220) },
                    }

                    for _, ch in ipairs(channels) do
                        local cRow = new("Frame", {
                            Size=UDim2.new(1,0,0,18), BackgroundTransparency=1, ZIndex=31,
                        }, pickerFrame)

                        new("TextLabel", {
                            Size=UDim2.new(0,10,1,0), BackgroundTransparency=1,
                            Text=ch.label, TextColor3=ch.col, FontFace=FONT, TextSize=10, ZIndex=32,
                        }, cRow)

                        local cTrack = new("Frame", {
                            Size=UDim2.new(1,-38,0,3), Position=UDim2.new(0,14,0.5,-1),
                            BackgroundColor3=Color3.fromRGB(42,42,44), BorderSizePixel=0, ZIndex=32,
                        }, cRow)
                        local cFill = new("Frame", {
                            Size=UDim2.new(ch.getter(),0,1,0), BackgroundColor3=ch.col, BorderSizePixel=0, ZIndex=33,
                        }, cTrack)
                        local cLbl = new("TextLabel", {
                            Size=UDim2.new(0,24,1,0), Position=UDim2.new(1,-24,0,-4),
                            BackgroundTransparency=1,
                            Text=tostring(math.round(ch.getter()*255)),
                            TextColor3=TXT_D, FontFace=FONT, TextSize=9, ZIndex=32,
                        }, cRow)

                        -- slider de cor (mesma lógica de captura)
                        local cDragging = false
                        local capF2 = nil
                        local function calcC(x)
                            local ax2 = cTrack.AbsolutePosition.X
                            local aw2 = cTrack.AbsoluteSize.X
                            if aw2==0 then return end
                            local t2 = math.clamp((x-ax2)/aw2, 0, 1)
                            ch.setter(t2)
                            cFill.Size = UDim2.new(t2,0,1,0)
                            cLbl.Text  = tostring(math.round(t2*255))
                            updateColor()
                        end
                        cTrack.InputBegan:Connect(function(i)
                            if i.UserInputType~=Enum.UserInputType.MouseButton1 then return end
                            cDragging=true; calcC(i.Position.X)
                            if capF2 then capF2:Destroy() end
                            local sgr = CG:FindFirstChild("DeadcellUI")
                            if sgr then
                                capF2 = new("Frame", {
                                    Size=UDim2.new(1,0,1,0), BackgroundTransparency=1, ZIndex=9999,
                                }, sgr)
                                capF2.InputChanged:Connect(function(mi)
                                    if cDragging and mi.UserInputType==Enum.UserInputType.MouseMovement then
                                        calcC(mi.Position.X)
                                    end
                                end)
                                capF2.InputEnded:Connect(function(mi)
                                    if mi.UserInputType==Enum.UserInputType.MouseButton1 then
                                        cDragging=false; capF2:Destroy(); capF2=nil
                                    end
                                end)
                            end
                        end)
                    end

                    -- preview
                    local prev = new("Frame", {
                        Size=UDim2.new(1,0,0,16), BackgroundColor3=color, BorderSizePixel=0, ZIndex=31,
                    }, pickerFrame)
                    corner(prev,2); stroke(prev,Color3.fromRGB(60,60,62),1)

                    -- atualiza preview ao mudar cor
                    local origCb = cb
                    cb = function(c)
                        prev.BackgroundColor3 = c
                        if origCb then origCb(c) end
                    end
                end

                swatch.MouseButton1Click:Connect(function()
                    pickerOpen = not pickerOpen
                    if pickerOpen then
                        buildPicker()
                    else
                        if pickerFrame then pickerFrame:Destroy(); pickerFrame=nil end
                    end
                end)

                local CP={}
                function CP:Set(c)
                    color=c; r=c.R; g=c.G; b=c.B; swatch.BackgroundColor3=c
                end
                function CP:Get() return color end
                return CP
            end

            -- ── Button ───────────────────────────────────
            function Section:AddButton(labelText, cb, danger)
                local btn = new("TextButton", {
                    Size=UDim2.new(1,0,0,24), BackgroundColor3=BG_ITEM, BorderSizePixel=0,
                    Text=labelText, TextColor3=TXT, FontFace=FONT, TextSize=11, AutoButtonColor=false,
                }, items)
                corner(btn,1)
                local bs = stroke(btn,BOR,1)
                btn.MouseEnter:Connect(function()
                    if danger then
                        tw(btn,{TextColor3=ACC_LT, BackgroundColor3=Color3.fromRGB(40,12,12)}); bs.Color=ACC
                    else
                        tw(btn,{TextColor3=TXT_H, BackgroundColor3=Color3.fromRGB(38,38,40)})
                    end
                end)
                btn.MouseLeave:Connect(function()
                    tw(btn,{TextColor3=TXT, BackgroundColor3=BG_ITEM})
                    if danger then bs.Color=BOR end
                end)
                btn.MouseButton1Click:Connect(function()
                    tw(btn,{BackgroundColor3=Color3.fromRGB(50,14,14)})
                    task.delay(0.12, function() tw(btn,{BackgroundColor3=BG_ITEM}) end)
                    if cb then cb() end
                end)
            end

            -- ── Label ────────────────────────────────────
            function Section:AddLabel(text)
                new("TextLabel", {
                    Size=UDim2.new(1,0,0,16), BackgroundTransparency=1,
                    Text=text, TextColor3=TXT_D, FontFace=FONT, TextSize=10,
                    TextXAlignment=Enum.TextXAlignment.Left,
                }, items)
            end

            -- ── Separator ────────────────────────────────
            function Section:AddSeparator()
                new("Frame", {
                    Size=UDim2.new(1,0,0,1), BackgroundColor3=BOR, BorderSizePixel=0,
                }, items)
            end

            -- ── ProfileList ──────────────────────────────
            function Section:AddProfileList(profileList, cb)
                local h = math.min(#profileList*22, 160)
                local container = new("ScrollingFrame", {
                    Size=UDim2.new(1,0,0,h), BackgroundColor3=BG_IN, BorderSizePixel=0,
                    ScrollBarThickness=2, ScrollBarImageColor3=BOR,
                    CanvasSize=UDim2.new(0,0,0,0), AutomaticCanvasSize=Enum.AutomaticSize.Y,
                }, items)
                stroke(container,BOR,1); vlist(container,0)
                local selBtn2 = nil
                for _, pName in ipairs(profileList) do
                    local pb = new("TextButton", {
                        Size=UDim2.new(1,0,0,22), BackgroundTransparency=1,
                        Text=pName, TextColor3=TXT, FontFace=FONT, TextSize=12,
                        TextXAlignment=Enum.TextXAlignment.Left, AutoButtonColor=false,
                    }, container)
                    pad(pb,0,0,10,0)
                    pb.MouseEnter:Connect(function()
                        if selBtn2~=pb then pb.BackgroundTransparency=0; pb.BackgroundColor3=Color3.fromRGB(36,36,38) end
                    end)
                    pb.MouseLeave:Connect(function()
                        if selBtn2~=pb then pb.BackgroundTransparency=1 end
                    end)
                    pb.MouseButton1Click:Connect(function()
                        if selBtn2 then selBtn2.TextColor3=TXT; selBtn2.BackgroundTransparency=1 end
                        selBtn2=pb; pb.TextColor3=ACC_LT; pb.BackgroundTransparency=0
                        pb.BackgroundColor3=Color3.fromRGB(40,12,12)
                        if cb then cb(pName) end
                    end)
                end
            end

            return Section
        end -- AddSection

        return Tab
    end -- AddTab

    return Window
end -- CreateWindow

return DeadcellUI
